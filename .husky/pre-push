echo "▶ [pre-push] Frontend Type-check..."
cd "$(git rev-parse --show-toplevel)/frontend"
npx tsc --noEmit -p tsconfig.app.json || { echo "❌ Frontend Type-check failed. Push aborted."; exit 1; }

echo "▶ [pre-push] Frontend Build..."
npm run build || { echo "❌ Frontend Build failed. Push aborted."; exit 1; }

echo "▶ [pre-push] Backend Checks..."
cd "$(git rev-parse --show-toplevel)/backend"
if [ -d "venv" ]; then
    source venv/bin/activate
    
    echo "  - Type-check (pyright)..."
    pyright || { echo "❌ Backend Type-check failed. Push aborted."; exit 1; }

    echo "  - Tests (pytest)..."
    pytest tests/ || { echo "❌ Backend Tests failed. Push aborted."; exit 1; }
else
    echo "⚠️ Python virtual environment not found. Skipping backend checks..."
fi

echo "✅ pre-push checks passed."
